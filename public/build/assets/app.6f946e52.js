var F=Object.defineProperty;var O=(e,t,n)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var u=(e,t,n)=>(O(e,typeof t!="symbol"?t+"":t,n),n);import{m as E}from"./module.esm.ff9cc1d2.js";import{S as d,l as o}from"./load.1f389728.js";let I=document.querySelector("#months_select_journal"),A=document.querySelector("#days_select_journal");function H(){let e=I.value,t=0;e=="01"?t=30:e=="02"?t=28:e=="03"?t=31:e=="04"?t=30:e=="05"?t=31:e=="06"?t=30:e=="07"||e=="08"?t=31:e=="09"?t=30:e=="10"?t=31:e=="11"?t=30:e=="12"&&(t=31),A.innerHTML="";for(var n=0;n<=t;n++){let r=n+1;r<10&&(r="0"+r),A.innerHTML+='<option value="'+r+'">'+r+"</option>"}}I.addEventListener("change",function(){H()});H();function s(e,t){let n=document.querySelector("#alertblock"),r=document.createElement("div");t=="error"?r.setAttribute("class","alert alert-danger"):t=="success"?r.setAttribute("class","alert alert-success"):r.setAttribute("class","alert alert-warning"),r.innerText=e,n.appendChild(r),setTimeout(function(){n.removeChild(r)},6e3)}const L=function(e){let t=e.children[0],n=e.children[1],r=t.elements.value,a=t.num_day.value+"."+t.num_month.value+"."+t.year.value;r.classList.contains("d-none")?(r.classList.remove("d-none"),r.classList.add("rating_input"),e.classList.add("null_padding"),n.classList.add("d-none")):(r.classList.add("d-none"),n.classList.remove("d-none"),e.classList.remove("null_padding"),r.title="",n.innerHTML===""&&r.value!=""?(n.innerHTML=r.value,N(t)):r.value==n.innerText||(n.innerText!==""&&r.value!==""?(n.innerHTML=r.value,r.value=n.innerHTML,G(t)):(P(t),n.innerHTML=r.value))),n.innerHTML===""?r.title="\u041E\u0446\u0435\u043D\u043A\u0430 \u0431\u0443\u0434\u0435\u0442 \u0432\u044B\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u0430 \u0437\u0430 "+a:r.title="\u041E\u0446\u0435\u043D\u043A\u0430 \u0431\u0443\u0434\u0435\u0442 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430 \u0437\u0430 "+a};function N(e){let t=new FormData(e);d("POST","create/rating",t).then(n=>J(JSON.parse(n).data,e)).catch(n=>s("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error")),v(e)}function P(e){let t=new FormData(e);d("POST","delete/rating",t).then(n=>s("\u041E\u0446\u0435\u043D\u043A\u0430 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0434\u0430\u043B\u0435\u043D\u0430")).catch(n=>s("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error")),v(e)}function G(e){let t=new FormData(e);d("POST","update/rating",t).then(n=>s("\u041E\u0446\u0435\u043D\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430","success")).catch(n=>s("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error")),v(e)}function J(e,t){let n=t.elements.rating_id,r=e.rating_id;n.setAttribute("value",r),s("\u041E\u0446\u0435\u043D\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0430","success")}function v(e){let t=window.journal.UserRatings;for(let n=0;n<t.length;n++)if(console.log(e),t[n].id==e.elements.user_id.value)for(let r=0;r<t[n].ratings.length;r++)t[n].ratings[r].num_day===e.elements.num_day.value&&(t[n].ratings[r]={num_day:e.elements.num_day.value,num_month:e.elements.num_month.value,subject_id:e.elements.subject_id.value,teacher_id:e.elements.teacher_id.value,value:e.elements.value.value,year:e.elements.year.value})}let z=class{constructor(e,t,n,r,a){u(this,"tableSize",20);u(this,"journal");u(this,"dateString");u(this,"dateArray",[]);u(this,"UserRatings");u(this,"day");u(this,"month");u(this,"year");u(this,"subject");u(this,"group");this.day=e,this.month=t,this.year=n,this.subject=r,this.group=a}appendDate(e,t=!1){this.dateArray.includes(e)||(this.dateArray.push(e),this.dateArray=this.dateArray.sort(function(n,r){return n-r}),t&&this.appendNewDateRating(e))}appendNewDateRating(e){let t=this.UserRatings;for(let n=0;n<t.length;n++){let r=t[n].ratings;t[n].ratings.push({num_day:e}),t[n].ratings=r.sort(function(a,l){return a.num_day-l.num_day})}this.UserRatings=t,this.AppendDateString(),this.AppendRatings(t),this.appendFunction("ratings",L)}createTable(e){this.PrepareDate(e)}PrepareDate(e){for(let r=0;r<e.length;r++)if(e[r].ratings.length>0){let a=e[r].ratings;for(let l=0;l<a.length;l++){let i=e[r].ratings[l].num_day;this.dateArray.includes(i)||this.dateArray.push(i)}e[r].ratings=a.sort(function(l,i){return l.num_day-i.num_day})}this.dateArray=this.dateArray.sort(function(r,a){return r-a});for(let r=0;r<e.length;r++){let a=e[r].ratings;for(let l=0;l<this.dateArray.length;l++){let i=this.dateArray[l];a.push({num_day:i})}e[r].ratings=a.sort(function(l,i){return l.num_day-i.num_day})}for(let r=0;r<e.length;r++){let a=e[r].ratings;if(a.length>this.dateArray.length){for(var t=0;t<a.length;t++){let l=a[t];for(var n=0;n<this.dateArray.length;n++){let i=this.dateArray[n];typeof l>"u"||i==l.num_day&&l.value&&delete a[t+1]}}a=a.filter((l,i)=>a.hasOwnProperty(i)),e[r].ratings=a}}this.UserRatings=e,this.AppendDateString(),this.AppendRatings(e),this.appendFunction("ratings",L)}AppendDateString(){this.journal=document.querySelector("#journal_table"),this.journal.innerHTML=" ";let e="dateString";this.journal.innerHTML+=`
            <ul class="list-group list-group-horizontal-sm" style = 'text-alight:center;' id = "`+e+'">'+this.getItemTable("\u0414\u0430\u0442\u0430/\u0424\u0418\u041E","300px")+`</ul>
        `,this.dateString=document.querySelector("#dateString");for(let t=0;t<this.tableSize;t++)typeof this.dateArray[t]<"u"?this.dateString.innerHTML+=this.getItemTable(this.dateArray[t]):this.dateString.innerHTML+=this.getItemTable("")}AppendRatings(e=this.UserRatings){for(let t=0;t<e.length;t++){let n="rating_string_num"+t;this.journal.innerHTML+='<ul class="list-group list-group-horizontal-sm" id = "'+n+'"></ul>';let r=document.querySelector("#"+n);r.innerHTML+=this.getItemTable(e[t].name,"300px");let a=e[t].id;for(let l=0;l<this.tableSize;l++){let i=e[t].ratings[l];typeof i<"u"?r.innerHTML+=this.getItemTableForm(i,a):(i=[],r.innerHTML+=this.getItemTable())}}}getItemTable(e="",t="40px"){return e==""?'<li class="list-group-item"  style = "color:white;width:'+t+';">1</li>':'<li class="list-group-item"  style = "width:'+t+'">'+e+"</li>"}getItemTableForm(e,t,n="40px"){let r=e.value;typeof r>"u"&&(r="");let a=e.teacher_id,l=e.subject_id;typeof l>"u"&&(l=this.subject);let i,m,g;typeof e.num_day<"u"?i=e.num_day:i=this.day,typeof e.num_month<"u"?m=e.num_month:m=this.month,typeof e.year<"u"?g=e.year:g=this.year;let D=t,C=e.rating_id,j;return j=`
        <li class="list-group-item ratings"  style = "width:`+n+`;">
            <form>
                <input type='text' name = 'user_id' value='`+D+`' class='d-none'>
                <input type='text' name = 'teacher_id' value='`+a+`' class='d-none'>
                <input type='text' name = 'subject_id' value='`+l+`' class='d-none'>
                <input type='text' name = 'num_day' value='`+i+`' class='d-none'>
                <input type='text' name = 'num_month' value='`+m+`' class='d-none'>
                <input type='text' name = 'year' value='`+g+`' class='d-none'>
                <input type='text' name = 'value' value='`+r+`' class='d-none rating_input' id = 'ratingInput'>
                <input type='text' name = 'rating_id' value='`+C+`' class='d-none rating_input' id = 'ratingId'>
            </form>
            <span>`+r+`</span>
        </li>`,j}appendFunction(e,t){let n=document.querySelectorAll("."+e);for(var r=0;r<n.length-1;r++){let a=n[r];a.ondblclick=function(){t(this)}}}};function B(e){for(let t=1;t<4;t++){let n=new Date,r=document.createElement("option"),a=n.getFullYear()-t;r.setAttribute("value",a),r.innerText=a,e.appendChild(r)}for(let t=0;t<4;t++){let n=new Date,r=document.createElement("option"),a=n.getFullYear()+t;t==0&&r.setAttribute("selected",""),r.setAttribute("value",a),r.innerText=a,e.appendChild(r)}}function b(e,t){o("body","\u041F\u043E\u0434\u0433\u0440\u0443\u0436\u0430\u044E \u0441\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u043E\u0432",!0),d("GET","get/subjects_group/"+e).then(n=>Y(JSON.parse(n).data,t)).catch(n=>s("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"))}function Y(e,t){t.innerHTML=" ";for(let n=0;n<e.length;n++){let r=document.createElement("option");r.setAttribute("value",e[n].id),r.innerText=e[n].name,t.appendChild(r)}o("body","\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043D\u043E",!1)}let y=document.querySelector("#group_select_journal"),T=document.querySelector("#subject_select_journal"),_=document.querySelector("#days_select_journal"),S=document.querySelector("#months_select_journal"),h=document.querySelector("#years_select_journal"),w;y.addEventListener("change",function(){c(),b(y.value,T)});T.addEventListener("change",function(){c()});S.addEventListener("change",function(){c()});h.addEventListener("change",function(){c()});_.addEventListener("change",function(){o("body","\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0434\u043D\u044F",!0),p.appendDate(_.value,!0),o("body","\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0434\u043D\u044F",!1)});function c(){let e=document.querySelector("#journal_form");w=document.querySelector("#journal_table"),w.innerHTML=" ",o("body",`\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043E\u0446\u0435\u043D\u043E\u043A
\u0414\u0430\u0442\u0430:`+S.value+"."+h.value,!0);let t=new FormData(e);d("POST","get/rating",t).then(n=>R(JSON.parse(n).data)).catch(n=>console.log(n))}let p;function R(e){p=new z(_.value,S.value,h.value,T.value,y.value),p.createTable(e),o("body","\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430",!1),window.journal=p}B(h);function $(e,t){o("body","\u041F\u043E\u0434\u0433\u0440\u0443\u0436\u0430\u044E \u0441\u043F\u0438\u0441\u043E\u043A c\u0442\u0443\u0434\u0435\u043D\u0442\u043E\u0432",!0),d("GET","get/users_group/"+e).then(n=>V(JSON.parse(n).data,t)).catch(n=>s("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"))}function V(e,t){t.innerHTML=" ";for(let n=0;n<e.length;n++){let r=document.createElement("option");r.setAttribute("value",e[n].id),r.innerText=e[n].name,t.appendChild(r)}o("body","\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043D\u043E",!1)}function M(e){d("GET","attestation/get/"+e).then(t=>k(JSON.parse(t).data)).catch(t=>s("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"))}function k(e){let t=document.querySelector("#recordstable");t.innerHTML=" ";for(var n=0;n<e.length;n++){let a=document.createElement("li");a.setAttribute("class","list-group-item row d-flex"),a.appendChild(r(e[n].subject)),a.appendChild(r(e[n].type_attestation,"text-center")),a.appendChild(r(e[n].group,"text-center")),a.appendChild(r(e[n].value,"text-center")),a.appendChild(r(e[n].name,"text-right")),t.appendChild(a)}function r(a,l=""){let i=document.createElement("span");return i.setAttribute("class","col "+l),i.innerText=a,i}}let f=document.getElementById("record_group");f.addEventListener("change",function(){let e=document.querySelector("#record_subject");b(f.value,e);let t=document.querySelector("#record_student");$(f.value,t)});function K(){let e=document.querySelector("#record"),t=new FormData(e);console.log(e.elements.group.value),d("POST","attestation/create",t).then(n=>M(e.elements.group.value)).catch(n=>s("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"))}document.querySelector("#createrecordbtn").onclick=()=>{K()};function q(){d("GET","get/hours").then(e=>Q(JSON.parse(e).data)).catch(e=>console.log(e))}function Q(e){let t=document.querySelector("#hourstable");t.innerHTML=" ";for(var n=0;n<e.length;n++){let a=document.createElement("li");a.setAttribute("class","list-group-item row d-flex"),a.appendChild(r(e[n].subject)),a.appendChild(r(e[n].group,"text-center")),a.appendChild(r(e[n].hours,"text-right")),t.appendChild(a)}function r(a,l=""){let i=document.createElement("span");return i.setAttribute("class","col "+l),i.innerText=a,i}o("body","\u0421\u043F\u0438\u0441\u044B\u0432\u0430\u044E \u0447\u0430\u0441\u044B",!1)}let x=document.getElementById("hour_group");x.addEventListener("change",function(){let e=document.querySelector("#hour_subject");b(x.value,e)});function W(e){o("body","\u0421\u043F\u0438\u0441\u044B\u0432\u0430\u044E \u0447\u0430\u0441\u044B",!0),d("POST","patch/hour",e).then(t=>q()).catch(t=>console.log(t))}window.Alpine=E;E.start();window.onload=()=>{setTimeout(c(),3e3),q(),M(document.getElementById("record_group").value)};document.getElementById("writeoffhoursbtn").onclick=()=>{let e=document.getElementById("writeoffhours"),t=new FormData(e);W(t)};
