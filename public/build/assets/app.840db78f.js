var q=Object.defineProperty;var F=(e,t,a)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var u=(e,t,a)=>(F(e,typeof t!="symbol"?t+"":t,a),a);import{m as w}from"./module.esm.ff9cc1d2.js";import{S as d,l as s}from"./load.1f389728.js";let I=document.querySelector("#months_select_journal"),S=document.querySelector("#days_select_journal");function H(){let e=I.value,t=0;e=="01"?t=30:e=="02"?t=28:e=="03"?t=31:e=="04"?t=30:e=="05"?t=31:e=="06"?t=30:e=="07"||e=="08"?t=31:e=="09"?t=30:e=="10"?t=31:e=="11"?t=30:e=="12"&&(t=31),S.innerHTML="";for(var a=0;a<=t;a++){let n=a+1;n<10&&(n="0"+n),S.innerHTML+='<option value="'+n+'">'+n+"</option>"}}I.addEventListener("change",function(){H()});H();function o(e,t){let a=document.querySelector("#alertblock"),n=document.createElement("div");t=="error"?n.setAttribute("class","alert alert-danger"):t=="success"?n.setAttribute("class","alert alert-success"):n.setAttribute("class","alert alert-warning"),n.innerText=e,a.appendChild(n),setTimeout(function(){a.removeChild(n)},6e3)}const j=function(e){let t=e.children[0],a=e.children[1],n=t.elements.value,l=t.num_day.value+"."+t.num_month.value+"."+t.year.value;n.classList.contains("d-none")?(n.classList.remove("d-none"),n.classList.add("rating_input"),e.classList.add("null_padding"),a.classList.add("d-none")):(n.classList.add("d-none"),a.classList.remove("d-none"),e.classList.remove("null_padding"),n.title="",a.innerHTML===""&&n.value!=""?(a.innerHTML=n.value,C(t)):n.value==a.innerText||(a.innerText!==""&&n.value!==""?(a.innerHTML=n.value,n.value=a.innerHTML,P(t)):(O(t),a.innerHTML=n.value))),a.innerHTML===""?n.title="\u041E\u0446\u0435\u043D\u043A\u0430 \u0431\u0443\u0434\u0435\u0442 \u0432\u044B\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u0430 \u0437\u0430 "+l:n.title="\u041E\u0446\u0435\u043D\u043A\u0430 \u0431\u0443\u0434\u0435\u0442 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430 \u0437\u0430 "+l};function C(e){let t=new FormData(e);d("POST","create/rating",t).then(a=>N(JSON.parse(a).data,e)).catch(a=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error")),_(e)}function O(e){let t=new FormData(e);d("POST","delete/rating",t).then(a=>o("\u041E\u0446\u0435\u043D\u043A\u0430 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0434\u0430\u043B\u0435\u043D\u0430")).catch(a=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error")),_(e)}function P(e){let t=new FormData(e);d("POST","update/rating",t).then(a=>o("\u041E\u0446\u0435\u043D\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430","success")).catch(a=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error")),_(e)}function N(e,t){let a=t.elements.rating_id,n=e.rating_id;a.setAttribute("value",n),o("\u041E\u0446\u0435\u043D\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0430","success")}function _(e){let t=window.journal.UserRatings;for(let a=0;a<t.length;a++)if(console.log(e),t[a].id==e.elements.user_id.value)for(let n=0;n<t[a].ratings.length;n++)t[a].ratings[n].num_day===e.elements.num_day.value&&(t[a].ratings[n]={num_day:e.elements.num_day.value,num_month:e.elements.num_month.value,subject_id:e.elements.subject_id.value,teacher_id:e.elements.teacher_id.value,value:e.elements.value.value,year:e.elements.year.value})}let z=class{constructor(e,t,a,n,l){u(this,"tableSize",20);u(this,"journal");u(this,"dateString");u(this,"dateArray",[]);u(this,"UserRatings");u(this,"day");u(this,"month");u(this,"year");u(this,"subject");u(this,"group");this.day=e,this.month=t,this.year=a,this.subject=n,this.group=l}appendDate(e,t=!1){this.dateArray.includes(e)||(this.dateArray.push(e),this.dateArray=this.dateArray.sort(function(a,n){return a-n}),t&&this.appendNewDateRating(e))}appendNewDateRating(e){let t=this.UserRatings;for(let a=0;a<t.length;a++){let n=t[a].ratings;t[a].ratings.push({num_day:e}),t[a].ratings=n.sort(function(l,r){return l.num_day-r.num_day})}this.UserRatings=t,this.AppendDateString(),this.AppendRatings(t),this.appendFunction("ratings",j)}createTable(e){this.PrepareDate(e)}PrepareDate(e){for(let n=0;n<e.length;n++)if(e[n].ratings.length>0){let l=e[n].ratings;for(let r=0;r<l.length;r++){let i=e[n].ratings[r].num_day;this.dateArray.includes(i)||this.dateArray.push(i)}e[n].ratings=l.sort(function(r,i){return r.num_day-i.num_day})}this.dateArray=this.dateArray.sort(function(n,l){return n-l});for(let n=0;n<e.length;n++){let l=e[n].ratings;for(let r=0;r<this.dateArray.length;r++){let i=this.dateArray[r];l.push({num_day:i})}e[n].ratings=l.sort(function(r,i){return r.num_day-i.num_day})}for(let n=0;n<e.length;n++){let l=e[n].ratings;if(l.length>this.dateArray.length){for(var t=0;t<l.length;t++){let r=l[t];for(var a=0;a<this.dateArray.length;a++){let i=this.dateArray[a];typeof r>"u"||i==r.num_day&&r.value&&delete l[t+1]}}l=l.filter((r,i)=>l.hasOwnProperty(i)),e[n].ratings=l}}this.UserRatings=e,this.AppendDateString(),this.AppendRatings(e),this.appendFunction("ratings",j)}AppendDateString(){this.journal=document.querySelector("#journal_table"),this.journal.innerHTML=" ";let e="dateString";this.journal.innerHTML+=`
            <ul class="list-group list-group-horizontal-sm" style = 'text-alight:center;' id = "`+e+'">'+this.getItemTable("\u0414\u0430\u0442\u0430/\u0424\u0418\u041E","300px")+`</ul>
        `,this.dateString=document.querySelector("#dateString");for(let t=0;t<this.tableSize;t++)typeof this.dateArray[t]<"u"?this.dateString.innerHTML+=this.getItemTable(this.dateArray[t]):this.dateString.innerHTML+=this.getItemTable("")}AppendRatings(e=this.UserRatings){for(let t=0;t<e.length;t++){let a="rating_string_num"+t;this.journal.innerHTML+='<ul class="list-group list-group-horizontal-sm" id = "'+a+'"></ul>';let n=document.querySelector("#"+a);n.innerHTML+=this.getItemTable(e[t].name,"300px");let l=e[t].id;for(let r=0;r<this.tableSize;r++){let i=e[t].ratings[r];typeof i<"u"?n.innerHTML+=this.getItemTableForm(i,l):(i=[],n.innerHTML+=this.getItemTable())}}}getItemTable(e="",t="40px"){return e==""?'<li class="list-group-item"  style = "color:white;width:'+t+';">1</li>':'<li class="list-group-item"  style = "width:'+t+'">'+e+"</li>"}getItemTableForm(e,t,a="40px"){let n=e.value;typeof n>"u"&&(n="");let l=e.teacher_id,r=e.subject_id;typeof r>"u"&&(r=this.subject);let i,m,g;typeof e.num_day<"u"?i=e.num_day:i=this.day,typeof e.num_month<"u"?m=e.num_month:m=this.month,typeof e.year<"u"?g=e.year:g=this.year;let D=t,E=e.rating_id,T;return T=`
        <li class="list-group-item ratings"  style = "width:`+a+`;">
            <form>
                <input type='text' name = 'user_id' value='`+D+`' class='d-none'>
                <input type='text' name = 'teacher_id' value='`+l+`' class='d-none'>
                <input type='text' name = 'subject_id' value='`+r+`' class='d-none'>
                <input type='text' name = 'num_day' value='`+i+`' class='d-none'>
                <input type='text' name = 'num_month' value='`+m+`' class='d-none'>
                <input type='text' name = 'year' value='`+g+`' class='d-none'>
                <input type='text' name = 'value' value='`+n+`' class='d-none rating_input' id = 'ratingInput'>
                <input type='text' name = 'rating_id' value='`+E+`' class='d-none rating_input' id = 'ratingId'>
            </form>
            <span>`+n+`</span>
        </li>`,T}appendFunction(e,t){let a=document.querySelectorAll("."+e);for(var n=0;n<a.length-1;n++){let l=a[n];l.ondblclick=function(){t(this)}}}};function G(e){for(let t=1;t<4;t++){let a=new Date,n=document.createElement("option"),l=a.getFullYear()-t;n.setAttribute("value",l),n.innerText=l,e.appendChild(n)}for(let t=0;t<4;t++){let a=new Date,n=document.createElement("option"),l=a.getFullYear()+t;t==0&&n.setAttribute("selected",""),n.setAttribute("value",l),n.innerText=l,e.appendChild(n)}}function M(e,t){s("body","\u041F\u043E\u0434\u0433\u0440\u0443\u0436\u0430\u044E \u0441\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u043E\u0432",!0),d("GET","get/subject_group/"+e).then(a=>J(JSON.parse(a).data,t)).catch(a=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"))}function J(e,t){t.innerHTML=" ";for(let a=0;a<e.length;a++){let n=document.createElement("option");n.setAttribute("value",e[a].id),n.innerText=e[a].name,t.appendChild(n)}s("body","\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043D\u043E",!1)}let f=document.querySelector("#group_select_journal"),v=document.querySelector("#subject_select_journal"),y=document.querySelector("#days_select_journal"),b=document.querySelector("#months_select_journal"),p=document.querySelector("#years_select_journal"),A;f.addEventListener("change",function(){c(),M(f.value,v)});v.addEventListener("change",function(){c()});b.addEventListener("change",function(){c()});p.addEventListener("change",function(){c()});y.addEventListener("change",function(){s("body","\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0434\u043D\u044F",!0),h.appendDate(y.value,!0),s("body","\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0434\u043D\u044F",!1)});function c(){let e=document.querySelector("#journal_form");A=document.querySelector("#journal_table"),A.innerHTML=" ",s("body",`\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043E\u0446\u0435\u043D\u043E\u043A
\u0414\u0430\u0442\u0430:`+b.value+"."+p.value,!0);let t=new FormData(e);d("POST","get/rating",t).then(a=>Y(JSON.parse(a).data)).catch(a=>console.log(a))}let h;function Y(e){h=new z(y.value,b.value,p.value,v.value,f.value),h.createTable(e),s("body","\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430",!1),window.journal=h}G(p);function x(){d("GET","get/hours").then(e=>B(JSON.parse(e).data)).catch(e=>console.log(e))}function B(e){let t=document.querySelector("#hourstable");t.innerHTML=" ";for(var a=0;a<e.length;a++){let l=document.createElement("li");l.setAttribute("class","list-group-item d-flex justify-content-between"),l.appendChild(n(e[a].subject)),l.appendChild(n(e[a].group)),l.appendChild(n(e[a].hours)),t.appendChild(l)}function n(l){let r=document.createElement("span");return r.innerText=l,r}}let L=document.getElementById("hour_group");L.addEventListener("change",function(){let e=document.querySelector("#hour_subject");M(L.value,e)});function V(e){s("body","\u0421\u043F\u0438\u0441\u044B\u0432\u0430\u044E \u0447\u0430\u0441\u044B",!0),d("POST","patch/hour",e).then(t=>x()).catch(t=>console.log(t)),s("body","\u0421\u043F\u0438\u0441\u044B\u0432\u0430\u044E \u0447\u0430\u0441\u044B",!1)}window.Alpine=w;w.start();window.onload=()=>{setTimeout(c(),3e3),x()};document.getElementById("writeoffhoursbtn").onclick=()=>{let e=document.getElementById("writeoffhours"),t=new FormData(e);V(t)};
