var R=Object.defineProperty;var G=(e,t,n)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var s=(e,t,n)=>(G(e,typeof t!="symbol"?t+"":t,n),n);import{m as D}from"./module.esm.ff9cc1d2.js";import{S as d,A as o,l as u}from"./load.f2ae5b0b.js";let M=document.querySelector("#months_select_journal"),E=document.querySelector("#days_select_journal");function C(){let e=M.value,t=0;e=="01"?t=30:e=="02"?t=28:e=="03"?t=31:e=="04"?t=30:e=="05"?t=31:e=="06"?t=30:e=="07"||e=="08"?t=31:e=="09"?t=30:e=="10"?t=31:e=="11"?t=30:e=="12"&&(t=31),E.innerHTML="";for(var n=0;n<=t;n++){let r=n+1;r<10&&(r="0"+r),E.innerHTML+='<option value="'+r+'">'+r+"</option>"}}M.addEventListener("change",function(){C()});C();const q=function(e){let t=e.children[0],n=e.children[1],r=t.elements.value,a=t.num_day.value+"."+t.num_month.value+"."+t.year.value;r.classList.contains("d-none")?(r.classList.remove("d-none"),r.classList.add("rating_input"),e.classList.add("null_padding"),n.classList.add("d-none")):(r.classList.add("d-none"),n.classList.remove("d-none"),e.classList.remove("null_padding"),r.title="",n.innerHTML===""&&r.value!=""?(n.innerHTML=r.value,B(t)):r.value==n.innerText||(n.innerText!==""&&r.value!==""?(n.innerHTML=r.value,r.value=n.innerHTML,z(t)):(J(t),n.innerHTML=r.value))),n.innerHTML===""?r.title="\u041E\u0446\u0435\u043D\u043A\u0430 \u0431\u0443\u0434\u0435\u0442 \u0432\u044B\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u0430 \u0437\u0430 "+a:r.title="\u041E\u0446\u0435\u043D\u043A\u0430 \u0431\u0443\u0434\u0435\u0442 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430 \u0437\u0430 "+a};function B(e){let t=new FormData(e);d("POST","create/rating",t).then(n=>$(JSON.parse(n).data,e)).catch(n=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error")),S(e)}function J(e){let t=new FormData(e);d("POST","delete/rating",t).then(n=>o("\u041E\u0446\u0435\u043D\u043A\u0430 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0434\u0430\u043B\u0435\u043D\u0430")).catch(n=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error")),S(e)}function z(e){let t=new FormData(e);d("POST","update/rating",t).then(n=>o("\u041E\u0446\u0435\u043D\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0430","success")).catch(n=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error")),S(e)}function $(e,t){let n=t.elements.rating_id,r=e.rating_id;n.setAttribute("value",r),o("\u041E\u0446\u0435\u043D\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0430","success")}function S(e){let t=window.journal.UserRatings;for(let n=0;n<t.length;n++)if(t[n].id==e.elements.user_id.value)for(let r=0;r<t[n].ratings.length;r++)t[n].ratings[r].num_day===e.elements.num_day.value&&(t[n].ratings[r]={num_day:e.elements.num_day.value,num_month:e.elements.num_month.value,subject_id:e.elements.subject_id.value,teacher_id:e.elements.teacher_id.value,value:e.elements.value.value,year:e.elements.year.value})}let k=class{constructor(e,t,n,r,a){s(this,"tableSize",20);s(this,"journal");s(this,"dateString");s(this,"dateArray",[]);s(this,"UserRatings");s(this,"day");s(this,"month");s(this,"year");s(this,"subject");s(this,"group");this.day=e,this.month=t,this.year=n,this.subject=r,this.group=a}appendDate(e,t=!1){if(!this.dateArray.includes(e)){let n=this.dateArray.pop();this.dateArray.push(e),this.dateArray.push(n),this.dateArray=this.dateArray.sort(function(r,a){return r-a}),t&&this.appendNewDateRating(e)}}appendNewDateRating(e){let t=this.UserRatings;for(let n=0;n<t.length;n++){let r=t[n].ratings;r.push({num_day:e}),r=r.sort(function(a,l){return a.num_day-l.num_day}),t[n].ratings=r}this.UserRatings=t,this.AppendDateString(),this.AppendRatings(t),this.appendFunction("ratings",q)}createTable(e){this.PrepareDate(e)}PrepareDate(e){for(let r=0;r<e.length;r++)if(e[r].ratings.length>0){let a=e[r].ratings;for(let l=0;l<a.length;l++){let i=e[r].ratings[l].num_day;this.dateArray.includes(i)||this.dateArray.push(i)}e[r].ratings=a.sort(function(l,i){return l.num_day-i.num_day})}this.dateArray=this.dateArray.sort(function(r,a){return r-a});for(let r=0;r<e.length;r++){let a=e[r].ratings;for(let l=0;l<this.dateArray.length;l++){let i=this.dateArray[l];a.push({num_day:i})}e[r].ratings=a.sort(function(l,i){return l.num_day-i.num_day})}for(let r=0;r<e.length;r++){let a=e[r].ratings;if(a.length>this.dateArray.length){for(var t=0;t<a.length;t++){let l=a[t];for(var n=0;n<this.dateArray.length;n++){let i=this.dateArray[n];typeof l>"u"||i==l.num_day&&l.value&&delete a[t+1]}}a=a.filter((l,i)=>a.hasOwnProperty(i)),e[r].ratings=a}}this.UserRatings=e,this.AppendDateString(),this.AppendRatings(e),this.appendFunction("ratings",q)}averageRating(e){let t=0,n=0;for(var r=0;r<e.length;r++){let l=e[r];typeof l.value<"u"&&(t=t+Number(l.value),n=n+1)}return(t/n).toFixed(1)}AppendDateString(){this.journal=document.querySelector("#journal_table"),this.journal.innerHTML=" ";let e="dateString";this.journal.innerHTML+=`
            <ul class="list-group list-group-horizontal-sm flex-row ul-bg-gray" style = 'text-alight:center;' id = "`+e+'">'+this.getItemTable("\u0424\u0418\u041E/\u0414\u0435\u043D\u044C","300px")+`</ul>
        `,this.dateString=document.querySelector("#dateString");for(let t=0;t<=this.tableSize;t++)typeof this.dateArray[t]<"u"?this.dateString.innerHTML+=this.getItemTable(this.dateArray[t]):this.dateString.innerHTML+=this.getItemTable("")}AppendRatings(e=this.UserRatings){for(let t=0;t<e.length;t++){let n="rating_string_num"+t;this.journal.innerHTML+='<ul class="list-group list-group-horizontal-sm flex-row" id = "'+n+'"></ul>';let r=document.querySelector("#"+n);r.innerHTML+=this.getItemTable(e[t].name,"300px");let a=e[t].id;for(let l=0;l<=this.tableSize;l++){let i=e[t].ratings[l];typeof i<"u"?r.innerHTML+=this.getItemTableForm(i,a):(i=[],r.innerHTML+=this.getItemTable())}}}getItemTable(e="",t="40px"){return e==""?'<li class="list-group-item"  style = "color:white;width:'+t+';"></li>':'<li class="list-group-item"  style = "width:'+t+'">'+e+"</li>"}getItemTableForm(e,t,n="40px"){let r=e.value;typeof r>"u"&&(r="");let a=e.teacher_id,l=e.subject_id;typeof l>"u"&&(l=this.subject);let i,c,f;typeof e.num_day<"u"?i=e.num_day:i=this.day,typeof e.num_month<"u"?c=e.num_month:c=this.month,typeof e.year<"u"?f=e.year:f=this.year;let N=t,P=e.rating_id,w;return w=`
        <li class="list-group-item ratings"  style = "width:`+n+`;">
            <form>
                <input type='text' name = 'user_id' value='`+N+`' class='d-none'>
                <input type='text' name = 'teacher_id' value='`+a+`' class='d-none'>
                <input type='text' name = 'subject_id' value='`+l+`' class='d-none'>
                <input type='text' name = 'num_day' value='`+i+`' class='d-none'>
                <input type='text' name = 'num_month' value='`+c+`' class='d-none'>
                <input type='text' name = 'year' value='`+f+`' class='d-none'>
                <input type='text' name = 'value' value='`+r+`' class='d-none rating_input' id = 'ratingInput'>
                <input type='text' name = 'rating_id' value='`+P+`' class='d-none rating_input' id = 'ratingId'>
            </form>
            <span>`+r+`</span>
        </li>`,w}appendFunction(e,t){let n=document.querySelectorAll("."+e);for(var r=0;r<n.length-1;r++){let a=n[r];a.ondblclick=function(){t(this)}}}};function F(e){for(let t=1;t<4;t++){let n=new Date,r=document.createElement("option"),a=n.getFullYear()-t;r.setAttribute("value",a),r.innerText=a,e.appendChild(r)}for(let t=0;t<4;t++){let n=new Date,r=document.createElement("option"),a=n.getFullYear()+t;t==0&&r.setAttribute("selected",""),r.setAttribute("value",a),r.innerText=a,e.appendChild(r)}}function A(e,t){u("body","\u041F\u043E\u0434\u0433\u0440\u0443\u0436\u0430\u044E \u0441\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u043E\u0432",!0),d("GET","get/subjects_group/"+e).then(n=>Y(JSON.parse(n).data,t)).catch(n=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"))}function Y(e,t){t.innerHTML=" ";for(let n=0;n<e.length;n++){let r=document.createElement("option");r.setAttribute("value",e[n].id),r.innerText=e[n].name,t.appendChild(r)}u("body","\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043D\u043E",!1)}let _=document.querySelector("#group_select_journal"),L=document.querySelector("#subject_select_journal"),v=document.querySelector("#days_select_journal"),j=document.querySelector("#months_select_journal"),m=document.querySelector("#years_select_journal"),I;_.addEventListener("change",function(){p(),A(_.value,L)});L.addEventListener("change",function(){p()});j.addEventListener("change",function(){p()});m.addEventListener("change",function(){p()});v.addEventListener("change",function(){u("body","\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0434\u043D\u044F",!0),h.appendDate(v.value,!0),u("body","\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0434\u043D\u044F",!1)});function p(){let e=document.querySelector("#journal_form");I=document.querySelector("#journal_table"),I.innerHTML=" ",u("body",`\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043E\u0446\u0435\u043D\u043E\u043A
\u0414\u0430\u0442\u0430:`+j.value+"."+m.value,!0);let t=new FormData(e);d("POST","get/rating",t).then(n=>V(JSON.parse(n).data)).catch(n=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"))}let h;function V(e){h=new k(v.value,j.value,m.value,L.value,_.value),h.createTable(e),u("body","\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430",!1),window.journal=h}F(m);function K(e,t){u("body","\u041F\u043E\u0434\u0433\u0440\u0443\u0436\u0430\u044E \u0441\u043F\u0438\u0441\u043E\u043A c\u0442\u0443\u0434\u0435\u043D\u0442\u043E\u0432",!0),d("GET","get/users_group/"+e).then(n=>Q(JSON.parse(n).data,t)).catch(n=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"))}function Q(e,t){t.innerHTML=" ";for(let n=0;n<e.length;n++){let r=document.createElement("option");r.setAttribute("value",e[n].id),r.innerText=e[n].name,t.appendChild(r)}u("body","\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043D\u043E",!1)}function W(e){u("body","\u0423\u0434\u0430\u043B\u044F\u044E",!0),d("GET","delete/attestation/"+e).then(n=>t()).catch(n=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"));function t(){o("\u0423\u0434\u0430\u043B\u0435\u043D\u043D\u043E"),u("body","\u0423\u0434\u0430\u043B\u0435\u043D\u043D\u043E",!1);let n=document.querySelector("#record");x(n.elements.group.value)}}function x(e){d("GET","get/attestation/"+e).then(t=>X(JSON.parse(t).data)).catch(t=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"))}function X(e){let t=document.querySelector("#recordstable");t.innerHTML=" ";for(var n=0;n<e.length;n++){let l=document.createElement("li");l.setAttribute("class","list-group-item row d-flex paddingnull"),l.appendChild(a(e[n].subject,"text-left")),l.appendChild(a(e[n].group,"text-center")),l.appendChild(a(e[n].value,"text-center")),l.appendChild(a(e[n].name,"text-right"));var r=e[n].id;l.ondblclick=function(){confirm("\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0430\u0442\u0442\u0435\u0441\u0442\u0430\u0446\u0438\u044E ?")&&W(r)},t.appendChild(l)}function a(l,i=""){let c=document.createElement("span");return c.setAttribute("class","col "+i),c.innerText=l,c}}let y=document.getElementById("record_group");y.addEventListener("change",function(){let e=document.querySelector("#record_subject");A(y.value,e);let t=document.querySelector("#record_student");K(y.value,t)});function Z(){let e=document.querySelector("#record"),t=new FormData(e);d("POST","create/attestation",t).then(n=>x(e.elements.group.value)).catch(n=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"))}document.querySelector("#createrecordbtn").onclick=()=>{Z()};let b=document.querySelector("#years_select_report"),T=document.querySelector("#group_select_report");function g(e){let t=document.querySelector(e);t=new FormData(t),u("body","\u041F\u043E\u0434\u0433\u0440\u0443\u0436\u0430\u044E \u0432\u0435\u0434\u043E\u043C\u043E\u0441\u0442\u0438",!0),d("POST","get/report",t).then(n=>U(n)).catch(n=>console.log(n))}b.addEventListener("change",function(){g("#report_form")});T.addEventListener("change",function(){g("#report_form")});function U(e){let t=JSON.parse(e).data,n=T.options[T.selectedIndex].text,r=b.options[b.selectedIndex].text,a=t.length;if(u("body","\u041F\u043E\u0434\u0433\u0440\u0443\u0436\u0430\u044E \u0432\u0435\u0434\u043E\u043C\u043E\u0441\u0442\u0438",!1),a==0){let l=document.querySelector("#parent_block_report");return l.innerHTML="<h2>\u041D\u0435\u0442 \u0432\u0435\u0434\u043E\u043C\u043E\u0441\u0442\u0435\u0439 "+n+" \u0437\u0430 "+r+"</h2>",!1}ee(t)}function ee(e){let t=document.querySelector("#parent_block_report");t.innerHTML="";let n=document.createElement("ul");n.setAttribute("class","list-group container-fluid zero-padding"),t.appendChild(n);for(let r=0;r<e.length;r++){let a=document.createElement("li");a.setAttribute("class","list-group-item d-flex row container-fluid file");let l=document.createElement("a");l.setAttribute("href",e[r].path),l.innerText=e[r].name,a.appendChild(l),n.appendChild(a)}}function te(e){let t=document.querySelector(e);t=new FormData(t),d("POST","create/report",t).then(n=>ne()).catch(n=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"))}function ne(){o("\u041E\u0442\u0447\u0435\u0442 \u0433\u043E\u0442\u043E\u0432","success"),g("#report_form")}let re=document.querySelector("#years_select_report");F(re);g("#report_form");document.querySelector("#createreportbtn").onclick=()=>{te("#report_form")};function O(){d("GET","get/hours").then(e=>ae(JSON.parse(e).data)).catch(e=>o("\u0427\u0442\u043E \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A","error"))}function ae(e){let t=document.querySelector("#hourstable");t.innerHTML=" ";for(var n=0;n<e.length;n++){let a=document.createElement("li");a.setAttribute("class","list-group-item row d-flex paddingnull"),a.appendChild(r(e[n].subject)),a.appendChild(r(e[n].group,"text-center")),a.appendChild(r(e[n].hours,"text-right")),t.appendChild(a)}function r(a,l=""){let i=document.createElement("span");return i.setAttribute("class","col "+l),i.innerText=a,i}u("body","\u0421\u043F\u0438\u0441\u044B\u0432\u0430\u044E \u0447\u0430\u0441\u044B",!1)}let H=document.getElementById("hour_group");H.addEventListener("change",function(){let e=document.querySelector("#hour_subject");A(H.value,e)});function le(e){u("body","\u0421\u043F\u0438\u0441\u044B\u0432\u0430\u044E \u0447\u0430\u0441\u044B",!0),d("POST","patch/hour",e).then(t=>O()).catch(t=>console.log(t))}window.Alpine=D;D.start();window.onload=()=>{setTimeout(p(),3e3),O(),x(document.getElementById("record_group").value)};document.getElementById("writeoffhoursbtn").onclick=()=>{let e=document.getElementById("writeoffhours"),t=new FormData(e);le(t)};
